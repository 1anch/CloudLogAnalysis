---

copyright:
  years: 2017

lastupdated: "2017-11-22"

---


{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}


# Analyze logs in Kibana for an app that is deployed in a Kubernetes cluster
{: #kibana_tutorial_1}

Get started with Kibana. Learn how to search and analyze container logs for an app that is deployed in a Kubernetes cluster.
{:shortdesc}

**Note:** To complete this tutorial, complete the tutorials that are linked from the different steps.

## Prerequisites
{: #prereq}

1. Be a member or an owner of an {{site.data.keyword.Bluemix_notm}} account with permissions to create Kubernetes standard clusters, deploy apps into clusters, and query the logs in {{site.data.keyword.Bluemix_notm}} for advanced analysis in Kibana.

2. Have a terminal session from where you can manage the Kubernetes cluster and deploy apps from the command line. The examples in this tutorial are given for an Ubuntu Linux system.

3. [Install the CLI plugins](/docs/containers/cs_cli_install.html#cs_cli_install_steps) in your Ubuntu system to manage the {{site.data.keyword.containershort}} from the command line. 


## Step 1: Get up and running with Kubernetes in the IBM Cloud
{: #step1}

Complete the following steps:

1. [Create a Kubernetes standard cluster](/docs/containers/cs_cluster.html#cs_cluster_ui).

2. Set up the cluster context in a Linux terminal. After the context is set, you can manage the Kubernetes cluster and deploy the application in the Kubernetes cluster.

    Log in to the region, organization, and space in the {{site.data.keyword.Bluemix_notm}} that is associated with the cluster that you created. For more information, see [How do I log in to the {{site.data.keyword.Bluemix_notm}}](/docs/services/CloudLogAnalysis/qa/cli_qa.html#login).

	Initialize the {{site.data.keyword.loganalysisshort}} service plug-in.

	```
	bx cs init
	```
	{: codeblock}

    Set your terminal context to your cluster.
    
	```
	bx cs cluster-config MyCluster
	```
	{: codeblock}

    The output of running this command provides the command that you must run in your terminal to set the path to your configuration file. For example:

	```
	export KUBECONFIG=/Users/ibm/.bluemix/plugins/container-service/clusters/MyCluster/kube-config-hou02-MyCluster.yml
	```
	{: codeblock}

    Copy and paste the command to set the environment variable in your terminal, and then press **Enter**.

	
## Step 2: Deploy an app in the Kubernetes cluster
{: #step2}

Deploy and run a sample app in the Kubernetes cluster. For more information, see [Lesson 1: Deploying single instance apps to Kubernetes clusters](/docs/containers/cs_tutorials_apps.html#cs_apps_tutorial_lesson1).

The app is a Hello World Node.js app:

```
var express = require('express')
var app = express()

app.get('/', function(req, res) {
  res.send('Hello world! Your app is up and running in a cluster!\n')
})
app.listen(8080, function() {
  console.log('Sample app is listening on port 8080.')
})
```
{: screen}

When the app is deployed, log collection is automatically enabled for any log entries that are sent by the app to stdout (standard output) and stderr (standard error). 

In this sample app, when you test your app in a browser, the app writes to stdout the following message: `Sample app is listening on port 8080.`


## Step 3: Analyze log data in Kibana
{: #step3}

1. Launch Kibana from a browser. 

    For more information on how to launch Kibana, see [Navigating to Kibana from a web browser](/docs/services/CloudLogAnalysis/kibana/launch.html#launch_Kibana_from_browser).

    To analyze log data for a cluster, you must access Kibana in the cloud Public region where the cluster is created. 
    
    For example, in the US South region, enter the following command to launch Kibana:
	
	```
	https://logging.ng.bluemix.net/ 
	```
	{: codeblock}
    
    Then, from a browser, launch the URL to open Kibana.
    
2. In the **Discover** page, look at the events that are displayed. 

    The sample Hello-World application generates one event.
    
    ![Discover page in Kibana](images/sampleapp_2.gif "Discover page in Kibana")
    
    In the *Available fields* section, you can see the list of fields that you can use to define new queries or filter the entries listed in the table that is displayed on the page.
    
    The following table lists some of the fields that you can use to define new search queries when analyzing application logs. The table also includes sample values that correspond to the event that is generated by the sample app:
 
    <table>
              <caption>Table 2. Common fields for container logs </caption>
               <tr>
                <th align="center">Field</th>
                <th align="center">Description</th>
                <th align="center">Example</th>
              </tr>
              <tr>
                <td>*ibm-containers.region_str*</td>
                <td>The value of this field corresponds to the {{site.data.keyword.Bluemix_notm}} region where the log entry is collected.</td>
                <td>us-south</td>
              </tr>
			  <tr>
                <td>*ibm-containers.account_id_str*</td>
                <td>Account ID.</td>
                <td></td>
              </tr>
			  <tr>
                <td>*ibm-containers.cluster_id_str*</td>
                <td>Cluster ID.</td>
                <td></td>
              </tr>
			  <tr>
                <td>*kubernetes.namespace_name_str*</td>
                <td>namespace name.</td>
                <td>*default* is the default value.</td>
              </tr>
              <tr>
                <td>*kubernetes.container_name_str*</td>
                <td>Container name</td>
                <td>hello-world-deployment</td>
              </tr>
              <tr>
                <td>*kubernetes.labels.label_name*</td>
                <td>Label fields are optional. You can have 0 or more labels. Each label starts with the prefix `kubernetes.labels.` followed by the *label_name*. </td>
                <td>In the sample app, you can see 2 labels: <br>* *kubernetes.labels.pod-template-hash_str* = 3355293961 <br>* *kubernetes.labels.run_str* =	hello-world-deployment  </td>
              </tr>
              <tr>
                <td>*stream_str*</td>
                <td>Type of log.</td>
                <td>*stdout*, *stderr*</td>
              </tr>
        </table>
     
    
    
3. Filter data in the *Discover* page.  

    In the table, you can see all the entries that are available for analysis. The entries that are listed correspond to the search query that is displayed in the *Search* bar. Use an asterisk (*) to display all entries within the period of time that is configured for the page.
    
    For example, to filter the data by Kubernetes namespace, modify the *Search* bar query. Add a filter based on the custom field *kubernetes.namespace_name_str*:
    
    1. In the **Available fields** section, select the field *kubernetes.namespace_name_str*. A subset of available values for the field is displayed.    
    
    2. Select the value **default**. This is the namespace where you deployed in a previous step the sample app.
    
        After you select the value, a filter is added to the *Search bar* and the table displays only entries that match the criteria you just selected.     
    
    You can select the filter's edit symbol to modify the namespace name that you search for.   
    
    The following query displays:
    
    ```
	{
        "query": {
          "match": {
            "kubernetes.namespace_name_str": {
              "query": "default",
              "type": "phrase"
            }
          }
        }
      }
    ```
	{: screen}
    
    To search for entries in a different namespace such as *mynamespace1*, modify the query:
    
    ```
	{
        "query": {
          "match": {
            "kubernetes.namespace_name_str": {
              "query": "mynamespace1",
              "type": "phrase"
            }
          }
        }
      }
    ```
	{: screen}
    
    If you cannot see any data, try changing the time filter. For more information, see [Setting a time filter](/docs/services/CloudLogAnalysis/kibana/filter_logs.html#set_time_filter).
    

For more information, see [Filtering logs in Kibana](/docs/services/CloudLogAnalysis/kibana/filter_logs.html#filter_logs).

